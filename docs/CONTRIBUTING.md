# Contributing to DY Crane Safety Management

First off, thank you for considering contributing! This project is a collaborative effort to build a robust and well-documented system, and your help is greatly appreciated.

This document provides guidelines for contributing to the project, including how to set up your development environment, our coding standards, and the process for submitting changes.

## Project Philosophy

Our goal is to create a modern, maintainable, and well-tested application. We follow a layered architecture on the backend and use modern tools for both the frontend and backend. A key part of our philosophy is "living documentation" â€“ creating tools like the `/test-client` that serve as both a testing utility and an interactive guide to the system's business logic.

## Setting Up Your Development Environment

To work on this project, you will need to set up both the backend (Python/FastAPI) and frontend (TypeScript/React) environments.

### 1. Prerequisites

-   **Git**: For version control.
-   **PostgreSQL (version 13 or higher)**: Our primary database. You need a running instance. You can run it locally or using Docker.
-   **Python (version 3.8 or higher)**: For the backend server.
-   **Node.js (version 16 or higher)** and **npm**: For the frontend client.

### 2. Fork and Clone the Repository

1.  **Fork** the repository on GitHub.
2.  **Clone** your fork to your local machine:
    ```sh
    git clone https://github.com/YOUR_USERNAME/dycrane_backend_proto.git
    cd dycrane_backend_proto
    ```

### 3. Backend Setup

The backend setup is managed primarily through the `scripts/dev.sh` script, which handles virtual environment creation and database setup.

1.  **Create a `.env` file**:
    Copy the example environment file and update it with your local PostgreSQL connection details.
    ```sh
    cp .env.example .env
    ```
    Make sure the `PGUSER`, `PGPASSWORD`, etc., match your local PostgreSQL setup.

2.  **Initialize the Database**:
    This is the most important step. Run the following command to create the virtual environment, install Python dependencies, create the database, run schema migrations, and seed it with initial data.
    ```sh
    ./scripts/dev.sh db/full
    ```

3.  **Run the Backend Server**:
    To start the FastAPI server for development (with hot-reloading):
    ```sh
    .venv/bin/uvicorn server.main:app --reload
    ```
    The backend API will be available at `http://localhost:8000`.

### 4. Frontend Setup

1.  **Navigate to the client directory**:
    ```sh
    cd client
    ```

2.  **Install dependencies**:
    ```sh
    npm install
    ```

3.  **Run the Frontend Dev Server**:
    ```sh
    npm run dev
    ```
    The frontend application will be available at `http://localhost:3000`. It is configured to proxy API requests to the backend server running on port 8000.

## Development Workflow

### Database Management

The `dev.sh` script provides commands to manage the database state, which is crucial for testing.

-   **Full Reset (`db/full`)**: Resets the entire database and re-seeds it with initial master data. Use this when you need a completely clean slate.
    ```sh
    ./scripts/dev.sh db/full
    ```
-   **Transactional Reset (`db/reset-transactional`)**: Clears only the data generated by workflow activities (sites, assignments, documents, etc.) while preserving master data (users, cranes). This is much faster and is the recommended way to reset the state between test runs.
    ```sh
    ./scripts/dev.sh db/reset-transactional
    ```
    The `/test-client` UI uses this transactional reset via its "Reset Workflow Data" button.

### Running Tests

-   **Run all E2E tests**:
    This command will first reset the database and then run the `pytest` suite.
    ```sh
    ./scripts/dev.sh test
    ```
-   **Run tests with verbose output**:
    ```sh
    ./scripts/dev.sh test/verbose
    ```

### Code Style and Linting

-   **Backend (Python)**: We use `ruff` for linting and `mypy` for type checking. You can run these checks using the `lint` command:
    ```sh
    ./scripts/dev.sh lint
    ```
-   **Frontend (TypeScript)**: We use ESLint and Prettier. These are typically integrated into your IDE for real-time feedback.

## Submitting Changes

1.  **Create a new branch** for your feature or bug fix:
    ```sh
    git checkout -b my-awesome-feature
    ```
2.  **Make your changes**.
3.  **Commit your changes** with a descriptive commit message.
4.  **Push your branch** to your fork on GitHub.
5.  **Open a Pull Request** from your fork to the main repository.
6.  Ensure your PR description clearly explains the problem and solution. Include screenshots or GIFs if you've made UI changes.

Thank you again for your contribution!
